<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Bookings - SpaceVoyager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Arri√®re-plan spatial avec √©toiles */
        body {
            background: linear-gradient(to bottom, #0a0e27 0%, #1a1f3a 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animation des √©toiles */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .star:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .star:nth-child(2) { top: 20%; left: 80%; animation-delay: 0.5s; }
        .star:nth-child(3) { top: 30%; left: 40%; animation-delay: 1s; }
        .star:nth-child(4) { top: 40%; left: 60%; animation-delay: 1.5s; }
        .star:nth-child(5) { top: 50%; left: 10%; animation-delay: 2s; }
        .star:nth-child(6) { top: 60%; left: 90%; animation-delay: 2.5s; }
        .star:nth-child(7) { top: 70%; left: 30%; animation-delay: 0.8s; }
        .star:nth-child(8) { top: 80%; left: 70%; animation-delay: 1.3s; }
        .star:nth-child(9) { top: 15%; left: 50%; animation-delay: 1.8s; }
        .star:nth-child(10) { top: 85%; left: 15%; animation-delay: 0.3s; }
        .star:nth-child(11) { top: 25%; left: 75%; animation-delay: 2.2s; }
        .star:nth-child(12) { top: 45%; left: 25%; animation-delay: 0.7s; }
        .star:nth-child(13) { top: 65%; left: 85%; animation-delay: 1.2s; }
        .star:nth-child(14) { top: 5%; left: 45%; animation-delay: 1.7s; }
        .star:nth-child(15) { top: 75%; left: 55%; animation-delay: 0.2s; }
        .star:nth-child(16) { top: 35%; left: 65%; animation-delay: 2.7s; }
        .star:nth-child(17) { top: 55%; left: 35%; animation-delay: 1.4s; }
        .star:nth-child(18) { top: 90%; left: 50%; animation-delay: 0.9s; }
        .star:nth-child(19) { top: 12%; left: 88%; animation-delay: 2.4s; }
        .star:nth-child(20) { top: 48%; left: 12%; animation-delay: 0.4s; }

        .booking-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .booking-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3);
        }

        .status-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-upcoming {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.5);
            color: #86efac;
        }

        .status-completed {
            background: rgba(100, 116, 139, 0.1);
            border: 1px solid rgba(100, 116, 139, 0.5);
            color: #cbd5e1;
        }

        .status-cancelled {
            background: rgba(248, 113, 113, 0.1);
            border: 1px solid rgba(248, 113, 113, 0.5);
            color: #fca5a5;
        }

        .action-button {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid;
        }

        .action-button-primary {
            background: rgba(0, 212, 255, 0.1);
            border-color: rgba(0, 212, 255, 0.5);
            color: #06b6d4;
        }

        .action-button-primary:hover {
            background: rgba(0, 212, 255, 0.2);
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .action-button-danger {
            background: rgba(248, 113, 113, 0.1);
            border-color: rgba(248, 113, 113, 0.5);
            color: #fca5a5;
        }

        .action-button-danger:hover {
            background: rgba(248, 113, 113, 0.2);
            box-shadow: 0 0 10px rgba(248, 113, 113, 0.3);
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 50;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(to br, rgb(15, 23, 42) 0%, rgb(15, 23, 42, 0.8) 100%);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            opacity: 0.5;
        }

        .filter-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(100, 116, 139, 0.3);
            background: rgba(100, 116, 139, 0.1);
        }

        .filter-badge.active {
            background: rgba(0, 212, 255, 0.2);
            border-color: rgba(0, 212, 255, 0.5);
            color: #06b6d4;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }

        .detail-label {
            color: #94a3b8;
            font-size: 0.875rem;
        }

        .detail-value {
            color: #e2e8f0;
            font-weight: 600;
        }
    </style>
</head>
<body class="text-white">
    <!-- √âtoiles anim√©es -->
    <div class="stars">
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
        <div class="star"></div>
    </div>

    <!-- Navigation -->
    <nav class="relative z-10 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-400 rounded-full flex items-center justify-center">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                    </svg>
                </div>
                <span class="text-xl font-bold">SpaceVoyager</span>
            </div>
            <div id="navLinks" class="hidden md:flex items-center gap-8">
                <a href="index.html" class="hover:text-cyan-400 transition">Home</a>
                <a href="destination.html" class="hover:text-cyan-400 transition">Destinations</a>
                <a href="booking.html" class="hover:text-cyan-400 transition">Booking</a>
                <a href="index.html#about" class="hover:text-cyan-400 transition">About</a>
                <a id="loginLink" href="login.html" class="text-cyan-400">Login</a>
                <span id="userEmail" class="text-cyan-300 hidden"></span>
                <button id="logoutBtn" class="hidden bg-cyan-600 hover:bg-cyan-500 px-4 py-2 rounded-lg text-white transition">
                    Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="relative z-10 px-6 py-12">
        <div class="max-w-6xl mx-auto">
            <!-- En-t√™te -->
            <div class="mb-12">
                <h1 class="text-5xl md:text-6xl font-bold mb-4 tracking-wider">
                    My Bookings
                </h1>
                <p class="text-gray-300 text-lg">
                    View, edit, and manage all your space travel reservations
                </p>
            </div>

            <!-- Filtres -->
            <div class="mb-8 flex gap-3 flex-wrap">
                <button class="filter-badge active" data-filter="all">All Bookings</button>
                <button class="filter-badge" data-filter="upcoming">Upcoming</button>
                <button class="filter-badge" data-filter="completed">Completed</button>
                <button class="filter-badge" data-filter="cancelled">Cancelled</button>
            </div>

            <!-- Liste des bookings -->
            <div id="bookingsContainer" class="space-y-6">
                <!-- Bookings will be loaded here -->
                <div class="empty-state">
                    <p class="text-gray-400 text-lg">Loading your bookings...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal D√©tails Booking -->
    <div id="bookingDetailsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold tracking-wide">Booking Details</h2>
                <button onclick="closeBookingDetailsModal()" class="text-gray-400 hover:text-white text-2xl">‚úï</button>
            </div>
            <div id="bookingDetailsContent"></div>
        </div>
    </div>

    <!-- Modal Confirmation Annulation -->
    <div id="cancelConfirmModal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-4">Cancel Booking?</h2>
            <p class="text-gray-300 mb-6">
                Are you sure you want to cancel this booking? This action cannot be undone.
            </p>
            <div class="flex gap-4">
                <button onclick="confirmCancelBooking()" class="flex-1 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white font-semibold transition">
                    Yes, Cancel Booking
                </button>
                <button onclick="closeConfirmModal()" class="flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-semibold transition">
                    No, Keep It
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Ticket -->
    <div id="ticketModal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold tracking-wide">Your Ticket</h2>
                <button onclick="closeTicketModal()" class="text-gray-400 hover:text-white text-2xl">‚úï</button>
            </div>
            <div id="ticketContent" class="mb-6 max-h-96 overflow-y-auto"></div>
            <div class="flex gap-4">
                <button onclick="printTicket()" class="flex-1 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white font-semibold transition">
                    üñ®Ô∏è Print
                </button>
                <button onclick="closeTicketModal()" class="flex-1 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-white font-semibold transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
// ==================== DATA & STATE ====================

const destinationsData = {
  "moon": { name: "The Moon", basePrice: 250000 },
  "mars": { name: "Mars", basePrice: 500000 },
  "iss": { name: "Orbital Station", basePrice: 150000 },
  "europa": { name: "Europa", basePrice: 750000 },
  "titan": { name: "Titan", basePrice: 1000000 }
};

const accommodationsData = {
  "standard": { name: "Standard Cabin", pricePerPassenger: 0 },
  "luxury": { name: "Luxury Suite", pricePerPassenger: 100000 },
  "zero-g": { name: "Zero-G Pod", pricePerPassenger: 150000 }
};

let allBookings = [];
let filteredBookings = [];
let currentFilter = 'all';
let pendingCancelBookingId = null;

// ==================== INITIALIZATION ====================

document.addEventListener('DOMContentLoaded', function() {
    loadBookings();
    initializeFilterButtons();
    updateSessionUI();
});

function loadBookings() {
    const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
    const userSession = JSON.parse(localStorage.getItem('userSession'));
    
    // Filter bookings by current user
    if (userSession && userSession.isLoggedIn) {
        allBookings = bookings.filter(b => b.userId === userSession.email);
    } else {
        // For guest users, show bookings with guest ID or all if no session
        allBookings = bookings;
    }

    // Sort by date (newest first)
    allBookings.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
    
    applyFilter('all');
}

function applyFilter(filterType) {
    currentFilter = filterType;
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    filteredBookings = allBookings.filter(booking => {
        const departureDate = new Date(booking.departureDate);
        
        if (filterType === 'upcoming') {
            return departureDate >= today && !booking.cancelled;
        } else if (filterType === 'completed') {
            return departureDate < today && !booking.cancelled;
        } else if (filterType === 'cancelled') {
            return booking.cancelled;
        }
        return true;
    });

    renderBookings();
    updateFilterButtons();
}

function initializeFilterButtons() {
    document.querySelectorAll('.filter-badge').forEach(btn => {
        btn.addEventListener('click', function() {
            applyFilter(this.dataset.filter);
        });
    });
}

function updateFilterButtons() {
    document.querySelectorAll('.filter-badge').forEach(btn => {
        if (btn.dataset.filter === currentFilter) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
}

// ==================== RENDERING ====================

function renderBookings() {
    const container = document.getElementById('bookingsContainer');

    if (filteredBookings.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4v.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <p class="text-gray-400 text-lg">No bookings found</p>
                <a href="booking.html" class="text-cyan-400 hover:underline mt-2 inline-block">Create a new booking</a>
            </div>
        `;
        return;
    }

    container.innerHTML = filteredBookings.map(booking => createBookingCard(booking)).join('');
}

function createBookingCard(booking) {
    const destination = destinationsData[booking.destination];
    const accommodation = accommodationsData[booking.accommodation];
    const departureDate = new Date(booking.departureDate);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    let status, statusClass;
    if (booking.cancelled) {
        status = 'Cancelled';
        statusClass = 'status-cancelled';
    } else if (departureDate < today) {
        status = 'Completed';
        statusClass = 'status-completed';
    } else {
        status = 'Upcoming';
        statusClass = 'status-upcoming';
    }

    const totalPrice = calculateBookingPrice(booking);

    return `
        <div class="booking-card bg-gradient-to-br from-slate-900/50 to-slate-800/30 backdrop-blur-sm rounded-2xl p-6 border border-slate-700/50">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
                <div class="flex-1">
                    <div class="flex items-center gap-4 mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-cyan-400">${destination.name}</h3>
                            <p class="text-gray-400 text-sm">Booking ID: ${booking.bookingId}</p>
                        </div>
                        <span class="status-badge ${statusClass}">${status}</span>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                        <div>
                            <p class="text-gray-400 text-sm">Departure</p>
                            <p class="font-semibold">${departureDate.toLocaleDateString()}</p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm">Passengers</p>
                            <p class="font-semibold">${booking.passengers}</p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm">Accommodation</p>
                            <p class="font-semibold">${accommodation.name}</p>
                        </div>
                        <div>
                            <p class="text-gray-400 text-sm">Total Price</p>
                            <p class="font-semibold text-cyan-400">$${totalPrice.toLocaleString()}</p>
                        </div>
                    </div>

                    <p class="text-gray-400 text-sm">
                        Passenger: <span class="text-white font-semibold">${booking.firstName} ${booking.lastName}</span>
                    </p>
                </div>

                <div class="flex flex-wrap gap-2">
                    <button onclick="viewBookingDetails('${booking.bookingId}')" class="action-button action-button-primary">
                        üëÅÔ∏è View Details
                    </button>
                    <button onclick="viewTicket('${booking.bookingId}')" class="action-button action-button-primary">
                        üé´ Ticket
                    </button>
                    ${!booking.cancelled && departureDate >= today ? `
                        <button onclick="editBooking('${booking.bookingId}')" class="action-button action-button-primary">
                            ‚úèÔ∏è Edit
                        </button>
                        <button onclick="prepareCancel('${booking.bookingId}')" class="action-button action-button-danger">
                            ‚úï Cancel
                        </button>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
}

// ==================== BOOKING ACTIONS ====================

function viewBookingDetails(bookingId) {
    const booking = allBookings.find(b => b.bookingId === bookingId);
    if (!booking) return;

    const destination = destinationsData[booking.destination];
    const accommodation = accommodationsData[booking.accommodation];
    const totalPrice = calculateBookingPrice(booking);
    const departureDate = new Date(booking.departureDate);

    let detailsHTML = `
        <div class="space-y-4">
            <div class="detail-row">
                <span class="detail-label">Booking ID:</span>
                <span class="detail-value">${booking.bookingId}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Destination:</span>
                <span class="detail-value">${destination.name}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Departure Date:</span>
                <span class="detail-value">${departureDate.toLocaleDateString()}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Accommodation:</span>
                <span class="detail-value">${accommodation.name}</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">Passengers:</span>
                <span class="detail-value">${booking.passengers}</span>
            </div>

            <div class="border-t border-slate-700 pt-4 mt-4">
                <h4 class="font-bold mb-3">Main Passenger</h4>
                <div class="detail-row">
                    <span class="detail-label">Name:</span>
                    <span class="detail-value">${booking.firstName} ${booking.lastName}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value text-sm">${booking.email}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value">${booking.phone}</span>
                </div>
            </div>

            ${booking.additionalPassengers && booking.additionalPassengers.length > 0 ? `
                <div class="border-t border-slate-700 pt-4 mt-4">
                    <h4 class="font-bold mb-3">Additional Passengers</h4>
                    ${booking.additionalPassengers.map((p, i) => `
                        <div class="mb-3 pb-3 border-b border-slate-700 last:border-b-0">
                            <p class="text-sm text-gray-400">Passenger ${i + 2}</p>
                            <p class="font-semibold">${p.firstName} ${p.lastName}</p>
                            <p class="text-sm text-gray-400">${p.email}</p>
                        </div>
                    `).join('')}
                </div>
            ` : ''}

            ${booking.requirements ? `
                <div class="border-t border-slate-700 pt-4 mt-4">
                    <h4 class="font-bold mb-2">Special Requirements</h4>
                    <p class="text-gray-300 text-sm">${booking.requirements}</p>
                </div>
            ` : ''}

            ${Object.keys(booking.extras || {}).length > 0 ? `
                <div class="border-t border-slate-700 pt-4 mt-4">
                    <h4 class="font-bold mb-3">Extras</h4>
                    ${Object.values(booking.extras).map(extra => `
                        <div class="detail-row">
                            <span class="detail-label">${extra.name}:</span>
                            <span class="detail-value">+$${extra.price.toLocaleString()}</span>
                        </div>
                    `).join('')}
                </div>
            ` : ''}

            <div class="border-t border-slate-700 pt-4 mt-4">
                <div class="detail-row">
                    <span class="font-bold">Total Price:</span>
                    <span class="detail-value text-lg text-cyan-400">$${totalPrice.toLocaleString()}</span>
                </div>
            </div>
        </div>
    `;

    document.getElementById('bookingDetailsContent').innerHTML = detailsHTML;
    document.getElementById('bookingDetailsModal').classList.add('active');
}

function viewTicket(bookingId) {
    const booking = allBookings.find(b => b.bookingId === bookingId);
    if (!booking) return;

    const destination = destinationsData[booking.destination];
    const accommodation = accommodationsData[booking.accommodation];
    const totalPrice = calculateBookingPrice(booking);
    const departureDate = new Date(booking.departureDate);

    const ticketHTML = `
        <div class="bg-gradient-to-br from-cyan-900/30 to-slate-900/30 border-2 border-cyan-400 rounded-xl p-6">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-cyan-400">SPACE VOYAGER</h1>
                <p class="text-gray-300 text-sm">Official Space Travel Ticket</p>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4 pb-4 border-b border-cyan-400/30 text-sm">
                <div>
                    <p class="text-gray-400">Booking ID</p>
                    <p class="font-bold">${booking.bookingId}</p>
                </div>
                <div>
                    <p class="text-gray-400">Issue Date</p>
                    <p class="font-bold">${new Date(booking.createdAt).toLocaleDateString()}</p>
                </div>
                <div>
                    <p class="text-gray-400">Passenger Name</p>
                    <p class="font-bold">${booking.firstName} ${booking.lastName}</p>
                </div>
                <div>
                    <p class="text-gray-400">Email</p>
                    <p class="font-bold text-xs">${booking.email}</p>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4 pb-4 border-b border-cyan-400/30 text-sm">
                <div>
                    <p class="text-gray-400">Destination</p>
                    <p class="font-bold text-cyan-400">${destination.name}</p>
                </div>
                <div>
                    <p class="text-gray-400">Departure Date</p>
                    <p class="font-bold">${departureDate.toLocaleDateString()}</p>
                </div>
                <div>
                    <p class="text-gray-400">Accommodation</p>
                    <p class="font-bold">${accommodation.name}</p>
                </div>
                <div>
                    <p class="text-gray-400">Total Passengers</p>
                    <p class="font-bold">${booking.passengers}</p>
                </div>
            </div>

            <div class="text-sm">
                <p class="font-bold text-cyan-400 mb-2">Price Breakdown</p>
                <div class="space-y-1 text-xs mb-3 pb-3 border-b border-cyan-400/30">
                    <div class="flex justify-between">
                        <span>Base Price:</span>
                        <span>$${destination.basePrice.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between">
                        <span>Accommodation:</span>
                        <span>$${(accommodation.pricePerPassenger * booking.passengers).toLocaleString()}</span>
                    </div>
                    ${Object.values(booking.extras || {}).length > 0 ? `
                        <div class="flex justify-between">
                            <span>Extras:</span>
                            <span>+$${Object.values(booking.extras).reduce((sum, e) => sum + e.price, 0).toLocaleString()}</span>
                        </div>
                    ` : ''}
                </div>
                <div class="flex justify-between font-bold text-cyan-400">
                    <span>Total:</span>
                    <span>$${totalPrice.toLocaleString()}</span>
                </div>
            </div>

            <p class="text-center text-xs text-gray-400 mt-4 pt-4 border-t border-cyan-400/30">
                Valid for the specified date and passenger(s)
            </p>
        </div>
    `;

    document.getElementById('ticketContent').innerHTML = ticketHTML;
    document.getElementById('ticketModal').classList.add('active');
}

function editBooking(bookingId) {
    const booking = allBookings.find(b => b.bookingId === bookingId);
    if (!booking) return;

    // Store booking data in sessionStorage for the booking form to retrieve
    sessionStorage.setItem('editBooking', JSON.stringify(booking));
    window.location.href = 'booking.html';
}

function prepareCancel(bookingId) {
    pendingCancelBookingId = bookingId;
    document.getElementById('cancelConfirmModal').classList.add('active');
}

function confirmCancelBooking() {
    if (!pendingCancelBookingId) return;

    const bookings = JSON.parse(localStorage.getItem('bookings')) || [];
    const index = bookings.findIndex(b => b.bookingId === pendingCancelBookingId);

    if (index !== -1) {
        bookings[index].cancelled = true;
        bookings[index].cancelledAt = new Date().toISOString();
        localStorage.setItem('bookings', JSON.stringify(bookings));
        
        alert('‚úì Booking cancelled successfully');
        loadBookings();
        closeConfirmModal();
    }
}

// ==================== MODALS ====================

function closeBookingDetailsModal() {
    document.getElementById('bookingDetailsModal').classList.remove('active');
}

function closeConfirmModal() {
    document.getElementById('cancelConfirmModal').classList.remove('active');
    pendingCancelBookingId = null;
}

function closeTicketModal() {
    document.getElementById('ticketModal').classList.remove('active');
}

function printTicket() {
    window.print();
}

// ==================== UTILITIES ====================

function calculateBookingPrice(booking) {
    const destination = destinationsData[booking.destination];
    const accommodation = accommodationsData[booking.accommodation];

    if (!destination) return 0;

    let total = destination.basePrice;
    total += accommodation.pricePerPassenger * booking.passengers;

    Object.values(booking.extras || {}).forEach(extra => {
        total += extra.price;
    });

    return total;
}

function updateSessionUI() {
    const userSession = JSON.parse(localStorage.getItem('userSession'));
    const loginLink = document.getElementById('loginLink');
    const logoutBtn = document.getElementById('logoutBtn');
    const userEmailSpan = document.getElementById('userEmail');

    if (userSession && userSession.isLoggedIn) {
        loginLink.classList.add('hidden');
        userEmailSpan.textContent = userSession.email;
        userEmailSpan.classList.remove('hidden');
        logoutBtn.classList.remove('hidden');

        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('userSession');
            alert('You have been logged out üëã');
            window.location.href = 'index.html';
        });
    }
}

// ==================== CLOSE MODALS ON OUTSIDE CLICK ====================

document.addEventListener('click', function(e) {
    if (e.target === document.getElementById('bookingDetailsModal')) {
        closeBookingDetailsModal();
    }
    if (e.target === document.getElementById('cancelConfirmModal')) {
        closeConfirmModal();
    }
    if (e.target === document.getElementById('ticketModal')) {
        closeTicketModal();
    }
});
    </script>
</body>
</html>